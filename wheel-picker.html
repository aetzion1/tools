<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wheel Picker</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: system-ui, -apple-system, sans-serif;
        background: #f5f5f5;
        min-height: 100vh;
        padding: 20px;
      }

      header {
        text-align: center;
        margin-bottom: 20px;
      }
      header h1 {
        color: #fff;
        font-size: 1.8rem;
      }

      main {
        max-width: 600px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }

      .input-row {
        display: flex;
        gap: 8px;
        width: 100%;
      }

      .input-row input {
        flex: 1;
        padding: 10px 14px;
        font-size: 1rem;
        border: 2px solid #ddd;
        border-radius: 8px;
        outline: none;
        transition: border-color 0.2s;
      }

      .input-row input:focus {
        border-color: #4ecdc4;
      }

      .input-row button {
        padding: 10px 20px;
        font-size: 1rem;
        background: #4ecdc4;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .input-row button:hover {
        background: #3dbdb5;
      }

      .wheel-container {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .pointer {
        width: 0;
        height: 0;
        border-left: 15px solid transparent;
        border-right: 15px solid transparent;
        border-top: 25px solid #333;
        margin-bottom: -5px;
        z-index: 10;
      }

      canvas {
        border-radius: 50%;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      }

      #spinBtn {
        margin-top: 15px;
        padding: 14px 40px;
        font-size: 1.2rem;
        font-weight: 600;
        background: #888;
        color: white;
        border: 3px solid white;
        border-radius: 10px;
        cursor: pointer;
        transition: background 0.2s, transform 0.1s;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      #spinBtn:hover:not(:disabled) {
        background: #999;
        transform: scale(1.02);
      }

      #spinBtn:disabled {
        background: #aaa;
        border-color: #ccc;
        cursor: not-allowed;
      }

      .items-section {
        width: 100%;
        margin-top: 10px;
      }

      .items-section h3 {
        font-size: 0.9rem;
        color: #fff;
        margin-bottom: 8px;
      }

      #itemsList {
        list-style: none;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      #itemsList li {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 10px;
        background: white;
        border-radius: 20px;
        font-size: 0.9rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .delete-btn {
        background: none;
        border: none;
        color: #999;
        font-size: 1.1rem;
        cursor: pointer;
        line-height: 1;
        padding: 0 2px;
      }

      .delete-btn:hover {
        color: #ff6b6b;
      }

      .hint {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.8);
        margin-top: -10px;
        text-align: center;
      }

      .winner-banner {
        margin-top: 15px;
        padding: 12px 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        transform: translateY(20px);
        opacity: 0;
        transition: transform 0.4s ease, opacity 0.4s ease;
      }

      .winner-banner.show {
        transform: translateY(0);
        opacity: 1;
      }

      .winner-banner.hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>ðŸŽ¡ Wheel Picker</h1>
    </header>

    <main>
      <div class="input-row">
        <input type="text" id="itemInput" placeholder="Enter names (comma-separated)..." />
        <button id="addBtn">Add</button>
      </div>
      <p class="hint">Tip: Add multiple items at once by separating them with commas</p>

      <div class="wheel-container">
        <div class="pointer"></div>
        <canvas id="wheel" width="400" height="400"></canvas>
        <button id="spinBtn" disabled>Spin!</button>
        <div id="winnerBanner" class="winner-banner hidden"></div>
      </div>

      <section class="items-section">
        <h3>Items on wheel:</h3>
        <ul id="itemsList"></ul>
      </section>
    </main>

    <script>
      const STORAGE_KEY = "wheelPickerItems";
      const COLORS = [
        "#FF6B6B",
        "#4ECDC4",
        "#45B7D1",
        "#96CEB4",
        "#FFEAA7",
        "#DDA0DD",
        "#98D8C8",
        "#F7DC6F",
        "#BB8FCE",
        "#85C1E9",
      ];
      const BACKGROUND_COLORS = [
        "#FF0000",
        "#00CC00",
        "#0066FF",
        "#FF6600",
        "#CC00CC",
        "#00CCCC",
      ];

      const canvas = document.getElementById("wheel");
      const ctx = canvas.getContext("2d");
      const itemInput = document.getElementById("itemInput");
      const addBtn = document.getElementById("addBtn");
      const spinBtn = document.getElementById("spinBtn");
      const itemsList = document.getElementById("itemsList");
      const winnerBanner = document.getElementById("winnerBanner");

      let items = [];
      let currentRotation = 0;
      let isSpinning = false;

      // localStorage
      const saveItems = () =>
        localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
      const loadItems = () =>
        JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

      // Get winner based on current rotation
      function getWinner() {
        if (items.length === 0) return null;
        const sliceAngle = 360 / items.length;
        // Normalize rotation to 0-360
        const normalizedRotation = ((currentRotation % 360) + 360) % 360;
        // The pointer is at top; calculate which slice is there
        const winningIndex = (Math.floor((360 - normalizedRotation) / sliceAngle) + items.length - 6) % items.length;
        return items[winningIndex];
      }

      // Show winner banner
      function showWinner(winner) {
        winnerBanner.textContent = `ðŸŽ‰ Winner: ${winner}!`;
        winnerBanner.classList.remove("hidden");
        // Trigger reflow for animation
        winnerBanner.offsetHeight;
        winnerBanner.classList.add("show");
        
        // Hide after 5 seconds
        setTimeout(() => {
          winnerBanner.classList.remove("show");
          setTimeout(() => winnerBanner.classList.add("hidden"), 400);
        }, 5000);
      }

      // Draw wheel
      function drawWheel() {
        const cx = canvas.width / 2;
        const cy = canvas.height / 2;
        const radius = Math.min(cx, cy) - 5;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (items.length === 0) {
          ctx.beginPath();
          ctx.arc(cx, cy, radius, 0, 2 * Math.PI);
          ctx.fillStyle = "#e0e0e0";
          ctx.fill();
          ctx.fillStyle = "#999";
          ctx.font = "16px system-ui";
          ctx.textAlign = "center";
          ctx.fillText("Add items to spin", cx, cy);
          return;
        }

        const sliceAngle = (2 * Math.PI) / items.length;
        const offset = -Math.PI; // First item text appears on right side

        items.forEach((item, i) => {
          const startAngle = offset + i * sliceAngle;
          const endAngle = startAngle + sliceAngle;

          // Draw slice
          ctx.beginPath();
          ctx.moveTo(cx, cy);
          ctx.arc(cx, cy, radius, startAngle, endAngle);
          ctx.closePath();
          ctx.fillStyle = COLORS[i % COLORS.length];
          ctx.fill();
          ctx.strokeStyle = "#fff";
          ctx.lineWidth = 2;
          ctx.stroke();

          // Draw text
          ctx.save();
          ctx.translate(cx, cy);
          ctx.rotate(startAngle + sliceAngle / 2);
          ctx.textAlign = "right";
          ctx.fillStyle = "#fff";
          ctx.font = "bold 14px system-ui";
          ctx.shadowColor = "rgba(0,0,0,0.3)";
          ctx.shadowBlur = 3;
          const maxLen = 12;
          const text =
            item.length > maxLen ? item.slice(0, maxLen) + "â€¦" : item;
          ctx.fillText(text, radius - 15, 5);
          ctx.restore();
        });
      }

      // Render items list
      function renderList() {
        itemsList.innerHTML = items
          .map(
            (item, i) =>
              `<li><span>${item}</span><button class="delete-btn" data-index="${i}">Ã—</button></li>`
          )
          .join("");
      }

      // Update spin button state
      function updateSpinBtn() {
        spinBtn.disabled = items.length === 0 || isSpinning;
      }

      // Add item(s) - supports comma-separated values
      function addItem() {
        const input = itemInput.value;
        if (!input.trim()) return;
        
        const newItems = input
          .split(',')
          .map(item => item.trim())
          .filter(item => item.length > 0);
        
        if (newItems.length === 0) return;
        
        items.push(...newItems);
        saveItems();
        drawWheel();
        renderList();
        updateSpinBtn();
        itemInput.value = "";
        itemInput.focus();
      }

      // Delete item
      function deleteItem(index) {
        items.splice(index, 1);
        saveItems();
        drawWheel();
        renderList();
        updateSpinBtn();
      }

      // Spin wheel
      function spin() {
        if (items.length === 0 || isSpinning) return;

        isSpinning = true;
        updateSpinBtn();

        const spins = 5 + Math.random() * 3; // 5-8 full rotations
        const randomAngle = Math.random() * 360;
        const totalRotation = currentRotation + spins * 360 + randomAngle;

        canvas.style.transition =
          "transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)";
        canvas.style.transform = `rotate(${totalRotation}deg)`;

        currentRotation = totalRotation;
      }

      // Handle spin end
      canvas.addEventListener("transitionend", () => {
        isSpinning = false;
        updateSpinBtn();
        const winner = getWinner();
        if (winner) showWinner(winner);
      });

      // Event listeners
      addBtn.addEventListener("click", addItem);
      itemInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") addItem();
      });
      spinBtn.addEventListener("click", spin);

      // Event delegation for delete buttons
      itemsList.addEventListener("click", (e) => {
        if (e.target.classList.contains("delete-btn")) {
          deleteItem(Number(e.target.dataset.index));
        }
      });

      // Initialize
      document.body.style.background =
        BACKGROUND_COLORS[Math.floor(Math.random() * BACKGROUND_COLORS.length)];
      items = loadItems();
      drawWheel();
      renderList();
      updateSpinBtn();
    </script>
  </body>
</html>
